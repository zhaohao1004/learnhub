# 产品需求文档 (PRD)

## 项目名称
**LearnHub** - 在线学习平台

## 1. 产品概述

LearnHub 是一个在线学习平台，旨在为用户提供沉浸式的学习体验。平台整合了视频课程、交互式文档和在线编程环境，让用户可以在一个统一的界面中完成从学习到实践的全过程。

### 核心价值
- **一体化学习体验**：视频、文档、代码实践无缝切换
- **即时反馈**：在线编写代码并立即运行验证
- **多语言支持**：支持 JavaScript/TypeScript 和 Python 等主流编程语言

## 2. 目标用户

### 主要用户群体
- **编程初学者**：希望通过视频+实践学习编程的新手
- **技能提升者**：需要系统学习新技术栈的开发者
- **教育培训机构**：需要在线教学平台的教育工作者

### 用户场景
1. 用户观看视频课程学习概念
2. 阅读配套文档深入理解
3. 在线编写代码实践验证
4. 运行测试确认学习成果

## 3. 核心功能

### 3.1 视频播放模块

#### 功能描述
提供流畅的视频播放体验，支持课程视频的在线观看。

#### 功能清单
| 功能 | 优先级 | 状态 | 描述 |
|------|--------|------|------|
| 视频播放 | P0 | ✅ | 支持 mp4/webm 格式视频播放 |
| 播放控制 | P0 | ✅ | 播放/暂停/快进/快退/音量调节 |
| 进度条 | P0 | ✅ | 显示播放进度，支持拖拽跳转 |
| 倍速播放 | P1 | ✅ | 0.5x/1x/1.5x/2x 倍速选择 |
| 全屏模式 | P1 | ⏳ | 支持全屏播放 |
| 进度记忆 | P2 | ⏳ | 记住上次播放位置 |

#### 技术方案
- ✅ 使用 `react-player` 作为播放器（动态导入禁用 SSR）
- ⏳ 支持 HLS 流媒体协议（可选）

### 3.2 文档阅读模块

#### 功能描述
提供格式化的技术文档阅读体验，支持 Markdown 渲染和代码高亮。

#### 功能清单
| 功能 | 优先级 | 状态 | 描述 |
|------|--------|------|------|
| Markdown 渲染 | P0 | ✅ | 支持 GitHub Flavored Markdown |
| 代码高亮 | P0 | ✅ | 支持多种编程语言语法高亮 |
| 目录导航 | P0 | ✅ | 自动生成文档目录，支持锚点跳转 |
| 代码复制 | P1 | ⏳ | 一键复制代码块 |
| 深色模式 | P1 | ✅ | 支持明暗主题切换 |
| 阅读进度 | P2 | ⏳ | 显示阅读进度条 |

#### 技术方案
- ✅ `react-markdown` + `remark-gfm` 处理 Markdown
- ✅ `prism-react-renderer` 实现代码高亮
- ✅ `next-themes` 实现主题切换

### 3.3 在线代码编辑器模块

#### 功能描述
提供在线编程环境，支持多语言代码编写、运行和测试验证。

#### 功能清单
| 功能 | 优先级 | 状态 | 描述 |
|------|--------|------|------|
| 代码编辑 | P0 | ✅ | Monaco Editor 集成，支持语法高亮和智能提示 |
| JavaScript 运行 | P0 | ✅ | 在浏览器中执行 JavaScript 代码 |
| TypeScript 运行 | P0 | ✅ | 支持 TypeScript 编译运行 |
| 控制台输出 | P0 | ✅ | 显示代码执行结果和错误信息 |
| Python 运行 | P1 | ✅ | 通过 Pyodide 在浏览器中运行 Python |
| 代码保存 | P1 | ✅ | 本地保存代码草稿，自动保存 |
| 测试验证 | P1 | ✅ | 运行预设测试用例验证代码正确性 |

#### 技术方案
- ✅ 编辑器：`@monaco-editor/react`
- ✅ JS/TS 执行：Function 构造器沙箱
- ✅ Python 执行：`pyodide` (CDN 加载)
- ✅ 代码存储：localStorage

### 3.4 整合学习页面

#### 功能描述
将视频、文档、代码编辑器整合到一个页面，实现边看边学的沉浸式体验。

#### 功能清单
| 功能 | 优先级 | 状态 | 描述 |
|------|--------|------|------|
| 三栏布局 | P0 | ✅ | 视频+文档+代码编辑器 |
| 可调节面板 | P0 | ✅ | 使用 react-resizable-panels |
| 课程导航 | P0 | ✅ | 上一课/下一课导航 |
| 进度追踪 | P1 | ⏳ | 视频进度和代码状态持久化 |

### 3.5 用户认证模块

#### 功能描述
ToB 场景用户认证系统，管理员创建用户，用户无法自行注册。

#### 功能清单
| 功能 | 优先级 | 状态 | 描述 |
|------|--------|------|------|
| 用户登录 | P0 | ✅ | 邮箱+密码登录 |
| 登出 | P0 | ✅ | 安全登出 |
| Session 管理 | P0 | ✅ | 自动刷新 Token |
| 路由保护 | P0 | ✅ | 中间件保护管理后台 |
| 角色权限 | P1 | ✅ | 管理员/普通用户区分 |

#### 技术方案
- ✅ `Supabase Auth` 用户认证
- ✅ `@supabase/ssr` 处理 SSR 场景
- ✅ 禁用公开注册

### 3.6 管理员后台模块

#### 功能描述
用户管理后台，支持管理员对用户进行 CRUD 操作。

#### 功能清单
| 功能 | 优先级 | 状态 | 描述 |
|------|--------|------|------|
| 用户列表 | P0 | ✅ | 查看所有用户 |
| 创建用户 | P0 | ✅ | 管理员创建新用户 |
| 编辑用户 | P0 | ✅ | 修改用户信息和角色 |
| 删除用户 | P0 | ✅ | 删除用户账户 |
| 权限控制 | P0 | ✅ | 仅管理员可访问 |

## 4. 技术架构

### 整体架构
```
┌─────────────────────────────────────────────────────────┐
│                    Frontend (Next.js 15)                 │
├─────────────┬─────────────┬─────────────┬───────────────┤
│   视频播放   │   文档阅读   │  代码编辑器  │   整合学习    │
│   Module    │   Module    │   Module    │    Page       │
├─────────────┴─────────────┴─────────────┴───────────────┤
│                    Shared Components                      │
│   (Layout, Panels, Navigation, Theme, Auth, Admin)       │
├─────────────────────────────────────────────────────────┤
│                    Code Execution Layer                   │
│        ┌──────────────┐    ┌──────────────┐             │
│        │  JS/TS Sandbox│    │  Pyodide     │             │
│        │  (Function)   │    │  (CDN/WASM)  │             │
│        └──────────────┘    └──────────────┘             │
├─────────────────────────────────────────────────────────┤
│                    Backend (Supabase)                     │
│        ┌──────────────┐    ┌──────────────┐             │
│        │  PostgreSQL  │    │  Auth        │             │
│        │  (RLS)       │    │  Service     │             │
│        └──────────────┘    └──────────────┘             │
└─────────────────────────────────────────────────────────┘
```

### 技术栈
| 层级 | 技术选型 |
|------|----------|
| 框架 | Next.js 15 (App Router) |
| 语言 | TypeScript |
| 样式 | Tailwind CSS + next-themes |
| 认证 | Supabase Auth + @supabase/ssr |
| 数据库 | Supabase PostgreSQL (RLS) |
| 视频播放 | react-player (动态导入) |
| Markdown | react-markdown + remark-gfm |
| 代码编辑器 | @monaco-editor/react |
| 面板布局 | react-resizable-panels |
| Python 运行 | pyodide (CDN) |
| 代码高亮 | prism-react-renderer |
| 图标 | lucide-react |
| E2E 测试 | @playwright/test |

## 5. 里程碑规划

### MVP (v0.1.0) - 已完成 ✅
- [x] 项目初始化和基础配置
- [x] 视频播放模块（P0 功能）
- [x] 文档阅读模块（P0 功能）
- [x] 代码编辑器模块（P0 功能 - JS/TS）
- [x] 整合学习页面
- [x] 可调节三栏布局

### v0.2.0 - 已完成 ✅
- [x] Python 代码执行支持 (Pyodide CDN)
- [x] 代码保存和加载 (localStorage)
- [x] 测试验证功能 (TestPanel)
- [x] 深色模式 (next-themes)
- [x] E2E 测试框架 (Playwright)

### v0.3.0 - 已完成 ✅
- [x] 用户认证 (P0) - Supabase Auth（ToB 场景）
- [x] 管理员后台 (P0) - 用户 CRUD 管理
- [x] 受保护路由 (P0) - 中间件路由保护
- [x] 角色权限 (P1) - 管理员/普通用户区分

### v0.4.0 - 待开发 ⏳
详见 `docs/PRD_backlog.md`
- [ ] 进度追踪 (P1)
- [ ] 课程管理 (P1)
- [ ] 用户数据持久化 (P1)

## 6. 验收标准

### 视频播放模块
- [x] 能够正常播放 mp4 格式视频
- [x] 播放控制（播放/暂停/进度调整）正常工作
- [x] 倍速播放功能正常

### 文档阅读模块
- [x] Markdown 正确渲染，包括表格、代码块、列表
- [x] 代码块语法高亮正确显示
- [x] 目录导航可以正确跳转到对应章节
- [x] 深色模式切换正常

### 代码编辑器模块
- [x] Monaco Editor 正常显示，支持语法高亮
- [x] JavaScript 代码可以执行并显示输出
- [x] TypeScript 代码可以编译执行
- [x] Python 代码可以通过 Pyodide 执行
- [x] 错误信息能够正确显示
- [x] 代码可以保存和加载
- [x] 测试验证功能正常工作

### 整合学习页面
- [x] 视频+文档+代码三栏布局正常显示
- [x] 面板可拖拽调节大小
- [x] 课程导航（上一课/下一课）正常工作

### 用户认证模块
- [x] 用户可以通过邮箱+密码登录
- [x] 登出功能正常
- [x] Session 自动刷新
- [x] 未认证用户无法访问管理后台

### 管理员后台
- [x] 管理员可以查看用户列表
- [x] 管理员可以创建新用户
- [x] 管理员可以编辑用户信息
- [x] 管理员可以删除用户

### 整体
- [x] 页面响应式布局，适配桌面端
- [x] `npm run dev` 可以正常启动开发服务器
- [x] `npm run build` 可以正常构建生产版本
- [x] E2E 测试可以正常运行

## 7. 文档索引

- `docs/PRD.md` - 产品需求文档（本文档）
- `docs/PRD_backlog.md` - 待开发功能积压列表
- `CLAUDE.md` - 项目开发指南
